---
layout: layouts/base.njk
---
{# Only include the syntax highlighter CSS on blog posts #}
{% css %}{% include "node_modules/prismjs/themes/prism-okaidia.css" %}{% endcss %}
{% css %}{% include "css/prism-diff.css" %}{% endcss %}
{# Auto-detect img-comparison-slider usage and include assets #}
{% if '<img-comparison-slider' in content %}
<link rel="stylesheet" href="/css/img-comparison-slider.css">
<script defer src="/js/img-comparison-slider.js"></script>
{% endif %}
<div class="h-entry">
<h2 class="p-name">{{ title }}</h2>

<ul class="post-metadata">
	<li><time class="dt-published" datetime="{{ page.date | htmlDateString }}">{{ page.date | readableDate }}</time></li>
	<li>{{ content | readingTime }}</li>
	{% for tag in tags | filterTagList %}
	{% set tagUrl %}/tags/{{ tag | slugify }}/{% endset %}
	<li><a href="{{ tagUrl }}" class="post-tag p-category" aria-label="Posts tagged {{ tag }}">{{ tag }}</a>{% if not loop.last %}, {% endif %}</li>
	{% endfor %}
</ul>
<a class="u-url" href="{{ page.url }}" aria-hidden="true" tabindex="-1"></a>
<a class="p-author h-card" href="https://dwk.io">{{ metadata.author.name }}</a>

{% set toc = content | tableOfContents %}
{% if toc.length >= 3 %}
<nav class="toc" aria-labelledby="toc-heading">
	<h3 id="toc-heading">Table of Contents</h3>
	<ol>
	{% for item in toc %}
		<li class="toc-level-{{ item.level }}"><a href="#{{ item.id }}">{{ item.text }}</a></li>
	{% endfor %}
	</ol>
</nav>
{% endif %}

<article class="e-content">
  {% if hero %}
    <figure class="hero-image">
      {% set src = page.filePathStem + '/' + hero.src %}
      {{ src }}
      {% if hero.caption %}
        <figcaption>{{ hero.caption }}</figcaption>
      {% endif %}
    </figure>
  {% endif %}
  {{ content | safe }}
  <p class="signature">-dwk</p>
</article>
</div>

{% set related = tags | relatedPosts(page.url, collections.posts) %}
{% if related.length > 0 %}
<aside class="related-posts" aria-labelledby="related-heading">
	<h3 id="related-heading">Related Posts</h3>
	<ul class="related-post-grid">
	{% for post in related %}
		{% set postTitle = post.data.title or post.url %}
		{% set postImage = post.templateContent | firstImage %}
		{% set socialImage = postTitle | socialImageUrl(postImage, post.inputPath) %}
		<li class="related-post-tile">
			<a href="{{ post.url }}" class="related-post-tile-link">
				<img class="related-post-tile-image" src="{{ socialImage }}" alt="" loading="lazy" eleventy:ignore>
				<span class="related-post-tile-title">{{ postTitle }}</span>
			</a>
		</li>
	{% endfor %}
	</ul>
</aside>
{% endif %}

{% renderTemplate "webc", {webmentions: webmentions, pageUrl: page.url, siteUrl: metadata.url} %}<web-mentions :webmentions="webmentions" :page-url="pageUrl" :site-url="siteUrl"></web-mentions>{% endrenderTemplate %}

{% if collections.posts %}
  {% set previousPost = collections.posts | getPreviousCollectionItem %}
  {% set nextPost = collections.posts | getNextCollectionItem %}
  {% if nextPost or previousPost %}
    <nav aria-label="Post navigation">
    <ul class="links-nextprev">
	    {%- if previousPost %}<li>Previous: <a href="{{ previousPost.url }}">{{ previousPost.data.title }}</a></li>{% endif %}
	    {%- if nextPost %}<li>Next: <a href="{{ nextPost.url }}">{{ nextPost.data.title }}</a></li>{% endif %}
    </ul>
    </nav>
  {%- endif %}
{%- endif %}
